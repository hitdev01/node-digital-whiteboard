<html>
  <head>
    <title>Digital Whiteboard</title>
  </head>
  <body>
    <div style="clear:both;">
      <canvas id="canvas" width="500" height="500"></canvas>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/color/jquery.color-2.1.2.min.js" integrity="sha256-H28SdxWrZ387Ldn0qogCzFiUDDxfPiNIyJX7BECQkDE=" crossorigin="anonymous"></script>
    <script src="fabric.min.js"></script>
    <script>
      $(document).ready(function(){
        var host = location.origin.replace(/^http/, 'ws');
        var ws = new WebSocket(host);
        ws.onmessage = function (event) {
          var canvasdata = JSON.parse(event.data);
          canvas.loadFromJSON(canvasdata, canvas.renderAll.bind(canvas), function(o, obj) {
            fabric.log(o, obj);
          });
        };

        /*
        * Canvas
        */
        // canvasを取得
        var canvas = new fabric.Canvas('canvas');
        canvas.isDrawingMode = true;
        canvas.freeDrawingColor = "red";
        canvas.freeDrawingLineWidth = 5;
        canvas.renderAll();
        canvas.calcOffset();

        canvas.on('mouse:up', function(e) {
          var canvasdata = JSON.stringify(canvas);
          ws.send(canvasdata);
        });

      });
    </script>
  </body>
</html>
